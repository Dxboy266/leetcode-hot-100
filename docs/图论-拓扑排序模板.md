# å›¾è®º - æ‹“æ‰‘æ’åºæ¨¡æ¿ ğŸ“Š

> æ‹“æ‰‘æ’åºæ˜¯å›¾è®ºä¸­çš„ç»å…¸ç®—æ³•ï¼Œç”¨äºè§£å†³æœ‰å‘æ— ç¯å›¾(DAG)çš„æ’åºé—®é¢˜

---

## ğŸ¯ æ‹“æ‰‘æ’åºåŸºç¡€

### ä»€ä¹ˆæ˜¯æ‹“æ‰‘æ’åºï¼Ÿ

**å®šä¹‰**ï¼šå¯¹æœ‰å‘æ— ç¯å›¾(DAG)çš„æ‰€æœ‰é¡¶ç‚¹è¿›è¡Œçº¿æ€§æ’åºï¼Œä½¿å¾—å¯¹äºä»»ä½•æœ‰å‘è¾¹ uâ†’vï¼Œu éƒ½æ’åœ¨ v ä¹‹å‰ã€‚

**åº”ç”¨åœºæ™¯**ï¼š
- è¯¾ç¨‹å®‰æ’ï¼ˆæœ‰å…ˆä¿®è¯¾ç¨‹è¦æ±‚ï¼‰
- ç¼–è¯‘ä¾èµ–å…³ç³»
- ä»»åŠ¡è°ƒåº¦
- æ£€æµ‹æœ‰å‘å›¾æ˜¯å¦æœ‰ç¯

**å…³é”®æ¦‚å¿µ**ï¼š
- **å…¥åº¦**ï¼šæŒ‡å‘è¯¥èŠ‚ç‚¹çš„è¾¹çš„æ•°é‡
- **å‡ºåº¦**ï¼šä»è¯¥èŠ‚ç‚¹å‡ºå‘çš„è¾¹çš„æ•°é‡
- **DAG**ï¼šæœ‰å‘æ— ç¯å›¾(Directed Acyclic Graph)

---

## ğŸ”§ ä¸¤ç§ç»å…¸ç®—æ³•

### ç®—æ³•ä¸€ï¼šBFS + Kahnç®—æ³• â­ æ¨è

**æ ¸å¿ƒæ€æƒ³**ï¼š
1. ç»Ÿè®¡æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦
2. å°†æ‰€æœ‰å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—
3. ä¸æ–­ä»é˜Ÿåˆ—ä¸­å–å‡ºèŠ‚ç‚¹ï¼Œå°†å…¶é‚»æ¥èŠ‚ç‚¹çš„å…¥åº¦å‡ 1
4. å¦‚æœé‚»æ¥èŠ‚ç‚¹å…¥åº¦å˜ä¸º 0ï¼ŒåŠ å…¥é˜Ÿåˆ—
5. é‡å¤æ­¥éª¤ 3-4ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©º

**é€šç”¨æ¨¡æ¿**ï¼š
```java
public boolean topologicalSort(int n, int[][] edges) {
    // 1. æ„å»ºå›¾çš„é‚»æ¥è¡¨å’Œå…¥åº¦æ•°ç»„
    List<List<Integer>> graph = new ArrayList<>();
    int[] inDegree = new int[n];
    
    for (int i = 0; i < n; i++) {
        graph.add(new ArrayList<>());
    }
    
    // æ„å»ºå›¾ï¼šfrom -> to
    for (int[] edge : edges) {
        int from = edge[0];
        int to = edge[1];
        graph.get(from).add(to);
        inDegree[to]++;
    }
    
    // 2. å°†æ‰€æœ‰å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—
    Queue<Integer> queue = new LinkedList<>();
    for (int i = 0; i < n; i++) {
        if (inDegree[i] == 0) {
            queue.offer(i);
        }
    }
    
    // 3. BFS æ‹“æ‰‘æ’åº
    int count = 0;  // è®°å½•è®¿é—®è¿‡çš„èŠ‚ç‚¹æ•°
    List<Integer> result = new ArrayList<>();  // æ‹“æ‰‘æ’åºç»“æœ
    
    while (!queue.isEmpty()) {
        int node = queue.poll();
        result.add(node);
        count++;
        
        // éå†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰é‚»æ¥èŠ‚ç‚¹
        for (int next : graph.get(node)) {
            inDegree[next]--;
            if (inDegree[next] == 0) {
                queue.offer(next);
            }
        }
    }
    
    // 4. åˆ¤æ–­æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®è¿‡ï¼ˆæ— ç¯ï¼‰
    return count == n;
}
```

**æ—¶é—´å¤æ‚åº¦**ï¼šO(V + E)ï¼ŒV ä¸ºèŠ‚ç‚¹æ•°ï¼ŒE ä¸ºè¾¹æ•°  
**ç©ºé—´å¤æ‚åº¦**ï¼šO(V + E)

---

### ç®—æ³•äºŒï¼šDFS + ä¸‰è‰²æ ‡è®°æ³•

**æ ¸å¿ƒæ€æƒ³**ï¼š
- **0 (ç™½è‰²)**ï¼šæœªè®¿é—®
- **1 (ç°è‰²)**ï¼šæ­£åœ¨è®¿é—®ï¼ˆåœ¨å½“å‰ DFS è·¯å¾„ä¸Šï¼‰
- **2 (é»‘è‰²)**ï¼šå·²å®Œæˆè®¿é—®
- å¦‚æœ DFS è¿‡ç¨‹ä¸­é‡åˆ°ç°è‰²èŠ‚ç‚¹ï¼Œè¯´æ˜å­˜åœ¨ç¯

**é€šç”¨æ¨¡æ¿**ï¼š
```java
public boolean topologicalSortDFS(int n, int[][] edges) {
    // 1. æ„å»ºå›¾çš„é‚»æ¥è¡¨
    List<List<Integer>> graph = new ArrayList<>();
    for (int i = 0; i < n; i++) {
        graph.add(new ArrayList<>());
    }
    
    for (int[] edge : edges) {
        graph.get(edge[0]).add(edge[1]);
    }
    
    // 2. åˆå§‹åŒ–çŠ¶æ€æ•°ç»„
    // 0: æœªè®¿é—®, 1: æ­£åœ¨è®¿é—®, 2: å·²å®Œæˆè®¿é—®
    int[] visited = new int[n];
    
    // 3. å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œ DFS
    for (int i = 0; i < n; i++) {
        if (visited[i] == 0) {
            if (hasCycle(graph, visited, i)) {
                return false;  // å­˜åœ¨ç¯
            }
        }
    }
    
    return true;  // æ— ç¯
}

private boolean hasCycle(List<List<Integer>> graph, int[] visited, int node) {
    // æ ‡è®°å½“å‰èŠ‚ç‚¹ä¸ºæ­£åœ¨è®¿é—®
    visited[node] = 1;
    
    // éå†æ‰€æœ‰é‚»æ¥èŠ‚ç‚¹
    for (int next : graph.get(node)) {
        if (visited[next] == 0) {
            // æœªè®¿é—®è¿‡ï¼Œç»§ç»­ DFS
            if (hasCycle(graph, visited, next)) {
                return true;
            }
        } else if (visited[next] == 1) {
            // æ­£åœ¨è®¿é—®ï¼Œè¯´æ˜å­˜åœ¨ç¯
            return true;
        }
        // visited[next] == 2ï¼Œå·²å®Œæˆè®¿é—®ï¼Œä¸éœ€è¦å†è®¿é—®
    }
    
    // æ ‡è®°å½“å‰èŠ‚ç‚¹ä¸ºå·²å®Œæˆè®¿é—®
    visited[node] = 2;
    return false;
}
```

**æ—¶é—´å¤æ‚åº¦**ï¼šO(V + E)  
**ç©ºé—´å¤æ‚åº¦**ï¼šO(V + E)

---

## ğŸ“š ç»å…¸é¢˜ç›®

### 1. è¯¾ç¨‹è¡¨ï¼ˆLeetCode 207ï¼‰â­â­â­

**é—®é¢˜**ï¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼ˆæ£€æµ‹æœ‰å‘å›¾æ˜¯å¦æœ‰ç¯ï¼‰

**è§£æ³•**ï¼šBFS + Kahn ç®—æ³•

```java
public boolean canFinish(int numCourses, int[][] prerequisites) {
    // æ„å»ºå›¾
    List<List<Integer>> graph = new ArrayList<>();
    int[] inDegree = new int[numCourses];
    
    for (int i = 0; i < numCourses; i++) {
        graph.add(new ArrayList<>());
    }
    
    // [è¯¾ç¨‹, å…ˆä¿®è¯¾ç¨‹] -> å…ˆä¿®è¯¾ç¨‹æŒ‡å‘è¯¾ç¨‹
    for (int[] pre : prerequisites) {
        int course = pre[0];
        int preCourse = pre[1];
        graph.get(preCourse).add(course);
        inDegree[course]++;
    }
    
    // BFS
    Queue<Integer> queue = new LinkedList<>();
    for (int i = 0; i < numCourses; i++) {
        if (inDegree[i] == 0) {
            queue.offer(i);
        }
    }
    
    int count = 0;
    while (!queue.isEmpty()) {
        int course = queue.poll();
        count++;
        
        for (int next : graph.get(course)) {
            inDegree[next]--;
            if (inDegree[next] == 0) {
                queue.offer(next);
            }
        }
    }
    
    return count == numCourses;
}
```

---

### 2. è¯¾ç¨‹è¡¨ IIï¼ˆLeetCode 210ï¼‰

**é—®é¢˜**ï¼šè¿”å›å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„é¡ºåºï¼ˆæ‹“æ‰‘æ’åºåºåˆ—ï¼‰

**è§£æ³•**ï¼šåœ¨è¯¾ç¨‹è¡¨ I çš„åŸºç¡€ä¸Šï¼Œè®°å½•æ‹“æ‰‘æ’åºç»“æœ

```java
public int[] findOrder(int numCourses, int[][] prerequisites) {
    List<List<Integer>> graph = new ArrayList<>();
    int[] inDegree = new int[numCourses];
    
    for (int i = 0; i < numCourses; i++) {
        graph.add(new ArrayList<>());
    }
    
    for (int[] pre : prerequisites) {
        graph.get(pre[1]).add(pre[0]);
        inDegree[pre[0]]++;
    }
    
    Queue<Integer> queue = new LinkedList<>();
    for (int i = 0; i < numCourses; i++) {
        if (inDegree[i] == 0) {
            queue.offer(i);
        }
    }
    
    int[] result = new int[numCourses];
    int index = 0;
    
    while (!queue.isEmpty()) {
        int course = queue.poll();
        result[index++] = course;  // è®°å½•æ‹“æ‰‘æ’åºç»“æœ
        
        for (int next : graph.get(course)) {
            inDegree[next]--;
            if (inDegree[next] == 0) {
                queue.offer(next);
            }
        }
    }
    
    // å¦‚æœå­˜åœ¨ç¯ï¼Œè¿”å›ç©ºæ•°ç»„
    return index == numCourses ? result : new int[0];
}
```

---

## ğŸ¯ ç®—æ³•å¯¹æ¯”

| ç‰¹æ€§ | BFS (Kahnç®—æ³•) | DFS (ä¸‰è‰²æ ‡è®°) |
|------|---------------|---------------|
| å®ç°éš¾åº¦ | â­â­ ç®€å• | â­â­â­ ä¸­ç­‰ |
| æ˜¯å¦è¿”å›æ‹“æ‰‘åº | âœ… ç›´æ¥å¾—åˆ° | âŒ éœ€è¦é¢å¤–å¤„ç† |
| æ£€æµ‹ç¯ | âœ… ç®€å•ï¼ˆåˆ¤æ–­countï¼‰ | âœ… ç›´è§‚ï¼ˆç°è‰²èŠ‚ç‚¹ï¼‰ |
| é€‚ç”¨åœºæ™¯ | éœ€è¦æ‹“æ‰‘åºçš„é¢˜ç›® | åªéœ€åˆ¤æ–­æ˜¯å¦æœ‰ç¯ |
| é¢è¯•æ¨èåº¦ | â­â­â­ | â­â­ |

**æ¨èä½¿ç”¨ BFS**ï¼š
- ä»£ç æ›´ç®€æ´
- ç›´æ¥å¾—åˆ°æ‹“æ‰‘æ’åºç»“æœ
- æ›´ç¬¦åˆç›´è§‰

---

## âš ï¸ æ˜“é”™ç‚¹

1. **è¾¹çš„æ–¹å‘æå**
   - âŒ `graph.get(to).add(from)` 
   - âœ… `graph.get(from).add(to)`

2. **å…¥åº¦åˆå§‹åŒ–é”™è¯¯**
   - âŒ å¿˜è®°ç»Ÿè®¡å…¥åº¦
   - âœ… æ„å»ºå›¾çš„åŒæ—¶ç»Ÿè®¡å…¥åº¦

3. **åˆ¤æ–­æ¡ä»¶é”™è¯¯**
   - âŒ `count > numCourses`
   - âœ… `count == numCourses`

4. **è‡ªç¯å¤„ç†**
   - âŒ æ²¡æœ‰è€ƒè™‘è‡ªç¯çš„æƒ…å†µ
   - âœ… è‡ªç¯ä¼šå¯¼è‡´å…¥åº¦æ°¸è¿œä¸ä¸º0ï¼Œè‡ªåŠ¨æ£€æµ‹å‡ºç¯

5. **DFS çŠ¶æ€æœªé‡ç½®**
   - âŒ å¤šæ¬¡ DFS æ—¶å¿˜è®°é‡ç½® visited
   - âœ… ä½¿ç”¨ä¸‰è‰²æ ‡è®°æ­£ç¡®å¤„ç†

---

## âœ… ç»ƒä¹ é¢˜ç›®æ¸…å•

### åŸºç¡€é¢˜ï¼ˆæŒæ¡æ¨¡æ¿ï¼‰
- [x] 207. è¯¾ç¨‹è¡¨ â­â­â­
- [ ] 210. è¯¾ç¨‹è¡¨ II
- [ ] 802. æ‰¾åˆ°æœ€ç»ˆçš„å®‰å…¨çŠ¶æ€

### è¿›é˜¶é¢˜ï¼ˆåº”ç”¨å˜å½¢ï¼‰
- [ ] 310. æœ€å°é«˜åº¦æ ‘
- [ ] 1136. å¹¶è¡Œè¯¾ç¨‹
- [ ] 2050. å¹¶è¡Œè¯¾ç¨‹ III

### å›°éš¾é¢˜ï¼ˆç»¼åˆè¿ç”¨ï¼‰
- [ ] 269. ç«æ˜Ÿè¯å…¸ï¼ˆéœ€è¦æ„å»ºå›¾ï¼‰
- [ ] 1203. é¡¹ç›®ç®¡ç†

---

## ğŸ’¡ è§£é¢˜æŠ€å·§

### 1. è¯†åˆ«æ‹“æ‰‘æ’åºé—®é¢˜

çœ‹åˆ°ä»¥ä¸‹å…³é”®è¯æ—¶ï¼Œè€ƒè™‘æ‹“æ‰‘æ’åºï¼š
- "å…ˆåé¡ºåº"ã€"ä¾èµ–å…³ç³»"
- "è¯¾ç¨‹å®‰æ’"ã€"ä»»åŠ¡è°ƒåº¦"
- "æ˜¯å¦å¯èƒ½å®Œæˆ"
- "æ£€æµ‹ç¯"

### 2. æ„å»ºå›¾çš„æ³¨æ„äº‹é¡¹

```java
// æ˜ç¡®è¾¹çš„æ–¹å‘
// [a, b] å¯èƒ½è¡¨ç¤ºï¼š
// 1. a ä¾èµ– b  -> b -> a
// 2. a æŒ‡å‘ b  -> a -> b

// LeetCode 207: [è¯¾ç¨‹, å…ˆä¿®è¯¾ç¨‹]
// è¡¨ç¤ºï¼šè¦å­¦è¯¾ç¨‹0ï¼Œå¿…é¡»å…ˆå­¦è¯¾ç¨‹1
// å³ï¼š1 -> 0
graph.get(prerequisites[1]).add(prerequisites[0]);
```

### 3. é€‰æ‹©åˆé€‚çš„ç®—æ³•

| é¢˜ç›®è¦æ±‚ | æ¨èç®—æ³• |
|---------|---------|
| åˆ¤æ–­æ˜¯å¦æœ‰ç¯ | BFS æˆ– DFS éƒ½å¯ |
| è¿”å›æ‹“æ‰‘æ’åºåºåˆ— | BFS (Kahn) â­ |
| è¿”å›æ‰€æœ‰æ‹“æ‰‘æ’åº | DFS + å›æº¯ |
| æœ€å°å­—å…¸åºçš„æ‹“æ‰‘æ’åº | BFS + ä¼˜å…ˆé˜Ÿåˆ— |

---

> **æœ€åæ›´æ–°**ï¼š2025-11-02  
> **æœ¬ä»“åº“å·²å®Œæˆ**ï¼š1é¢˜ï¼ˆ207.è¯¾ç¨‹è¡¨ï¼‰

